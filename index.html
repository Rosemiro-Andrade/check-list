<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Check List - Manutenção Preventiva</title>
  <link rel="stylesheet" href="checklist.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container" id="formulario">
    <div class="header">
      <img src="image/zilia.png" alt="Zilia Logotipo" class="logo-zilia">  
    </div>
      <h1>CHECK LIST</h1>
      <h2>MANUTENÇÃO PREVENTIVA</h2>
    </div>

    <div class="periodicidade">
      <label for="periodicidade">Periodicidade:</label>
      <select id="periodicidade">
        <option value="quinzenal">Quinzenal</option>
        <option value="mensal">Mensal</option>
        <option value="trimestral">Trimestral</option>
        <option value="semestral">Semestral</option>
        <option value="anual">Anual</option>
      </select>
    </div>

    <div class="meta">
      <div class="field"><label>Equipamento</label><input id="equipamento" type="text" placeholder="Ex: Servidor X"/></div>
      <div class="field"><label>Ativo Fixo</label><input id="ativo" type="text" /></div>
      <div class="field"><label>Módulo</label><input id="modulo" type="text" /></div>
      <div class="field"><label>SSD</label><input id="ssd" type="text" /></div>
    </div>

    <div class="tabela-dinamica">
      <table id="itemsTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Descrição</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" value=""/></td>
            <td><input type="text" value=""/></td>
            <td><input type="text" value=""/></td>
          </tr>
        </tbody>
      </table>
      <button type="button" onclick="adicionarLinha()">Adicionar Linha</button>
      <button type="button" onclick="removerLinha()">Remover Última Linha</button>
    </div>

    <div class="obs">
      <label>OBSERVAÇÕES:</label>
      <textarea id="observacoes"></textarea>
    </div>

    <div class="footer">
      <label>DATA:</label><input id="data" type="date" />
      <label>TÉCNICO:</label><input id="tecnico" type="text" />
      <label>ID:</label><input id="ident" type="text" />
    </div>

    <div class="controls">
      <button type="button" id="generatePdf">Gerar PDF</button>
    </div>
  </div>

  <script>
    // Adicionar/Remover Linhas da Tabela
    function adicionarLinha() {
      const tbody = document.getElementById('itemsTable').querySelector('tbody');
      const tr = document.createElement('tr');
      for (let i = 0; i < 3; i++) {
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.type = 'text';
        td.appendChild(input);
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }

    function removerLinha() {
      const tbody = document.getElementById('itemsTable').querySelector('tbody');
      if (tbody.rows.length > 1) tbody.removeChild(tbody.lastChild);
      else alert('A tabela deve ter pelo menos uma linha.');
    }

    // Função para gerar PDF com jsPDF + AutoTable
    document.getElementById('generatePdf').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Cabeçalho
      doc.setFontSize(16);
      doc.text("CHECK LIST", 105, 15, null, null, "center");
      doc.setFontSize(12);
      doc.text("MANUTENÇÃO PREVENTIVA", 105, 25, null, null, "center");

      // Dados principais
      const equipamento = document.getElementById('equipamento').value;
      const ativo = document.getElementById('ativo').value;
      const modulo = document.getElementById('modulo').value;
      const ssd = document.getElementById('ssd').value;
      const periodicidade = document.getElementById('periodicidade').value;

      doc.setFontSize(10);
      doc.text(`Equipamento: ${equipamento}`, 14, 40);
      doc.text(`Ativo Fixo: ${ativo}`, 14, 46);
      doc.text(`Módulo: ${modulo}`, 14, 52);
      doc.text(`SSD: ${ssd}`, 14, 58);
      doc.text(`Periodicidade: ${periodicidade}`, 14, 64);

      // Tabela
      const headers = [["Item", "Descrição", "Status"]];
      const tbody = document.getElementById('itemsTable').querySelector('tbody');
      const data = Array.from(tbody.rows).map(row => 
        Array.from(row.cells).map(cell => cell.querySelector('input').value)
      );

      doc.autoTable({
        startY: 70,
        head: headers,
        body: data,
        styles: { fontSize: 10 },
        theme: 'grid',
        headStyles: { fillColor: [220, 220, 220] },
        margin: { left: 14, right: 14 }
      });

      // Observações e rodapé
      const finalY = doc.lastAutoTable.finalY || 70;
      const observacoes = document.getElementById('observacoes').value;
      const dataText = document.getElementById('data').value;
      const tecnico = document.getElementById('tecnico').value;
      const ident = document.getElementById('ident').value;

      doc.text("Observações:", 14, finalY + 10);
      doc.text(observacoes || "-", 14, finalY + 16);

      doc.text(`DATA: ${dataText}`, 14, finalY + 30);
      doc.text(`TÉCNICO: ${tecnico}`, 14, finalY + 36);
      doc.text(`ID: ${ident}`, 14, finalY + 42);

      doc.save('checklist.pdf');
    });
  </script>
</body>
</html>
